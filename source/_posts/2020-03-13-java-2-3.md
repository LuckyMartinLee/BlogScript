---

title: Java 深入理解 JVM
date: 2020-01-13 14:16:21
tags:
- Java
typora-root-url: ..
---

#### JDK 体系结构

![image-20210530203536048](/post_imgs/java_2-3-1.png)

javac：Java编译器，将Java源代码换成字节代
java：Java解释器，直接从类文件执行Java应用程序代码
appletviewer(小程序浏览器)：一种执行HTML文件上的Java小程序类的Java浏览器
javadoc：根据Java源代码及其说明语句生成的HTML文档
jdb：Java调试器，可以逐行地执行程序、设置断点和检查变量
javah：产生可以调用Java过程的C过程，或建立能被Java程序调用的C过程的头文件
Javap：Java反汇编器，显示编译类文件中的可访问功能和数据，同时显示字节代码含义
jar：多用途的存档及压缩工具，是个java应用程序，可将多个文件合并为单个JAR归档文件。

htmlConverter——命令转换工具。
native2ascii——将含有不是Unicode或Latinl字符的的文件转换为Unicode编码字符的文件。
serialver——返回serialverUID。语法：serialver [show] 命令选项show是用来显示一个简单的界面。输入完整的类名按Enter键或"显示"按钮，可显示serialverUID。

#### Java 跨平台性

![image-20210530204507999](/post_imgs/java_2-3-2.png)

只所以实现跨平台，是不同平台对应的的JVM 将 相同的 `.class` 字节码文件，转化为 对应平台的机器码，从而实现跨平台。

#### JVM 内存区域模型

![image-20210530204826767](/post_imgs/java_2-3-3.png)

##### 栈

虚拟机栈， 线程栈，线程独有。每个线程都会从这个栈中分一部分内存，用于存储这个线程中用到的 局部变量等，这一小部分专用于这个线程的栈内存空间，又是以  `栈帧` 的形式 存储方法信息，结构如下

![image-20210530211734711](/post_imgs/java_2-3-4.png)

- 局部变量表(Local Variable Table)

  是一组变量值存储空间，用于存放方法参数和方法内部定义的局部变量。

  注：局部变量表以变量槽(solt)为最小单位，一个变量槽最大只允许保存四字节(即:32位)长度的变量。如果超过32位，则会开辟两个连续的solt。

- 操作数栈(Operand Stack) 

  表达式计算在操作数栈中完成。当一个方法刚刚开始执行的时候，这个方法的操作数栈是空的，在方法的执行过程中，会有各种字节码指令往操作数栈中写入和提取内容，也就是出栈/入栈操作。
  
- 动态链接(Dynamic Linking)

  每个栈帧都包含一个指向运行时常量池中该栈帧所属方法的引用，持有这个引用是为了支持方法调用过程中的动态链接。
  在类加载阶段中的解析阶段会将符号引用转为直接引用，这种转化也称为静态解析。另外的一部分将在运行时转化为直接引用，这部分称为动态链接。

- 方法出口/返回地址（Return Address）
  
  方法开始执行后，只有 2 种方式可以退出 ：方法返回指令，异常退出。
  
  注：一般来说，方法正常退出时，调用者的`程序计数器`的值可以作为返回地址，栈帧中返回地址很可能会保存这个计数器值。而方法异常退出时，返回地址是要通过异常处理器表来决定的，栈帧中返回地址一般不会保存这部分信息。

##### 程序计数器

线程独有，是由`执行引擎`修改并记录当前线程正在这些代码的行号（实际是 在方法区中代码的实际内存地址），因为CPU是并发的，多线程同时运行，线程调度时，被挂起的线程要记录当前线程的执行位置，为下次在运行提供执行位置。